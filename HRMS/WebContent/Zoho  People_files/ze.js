function ZE(a){this.state="loading";this.mode="richtext";this.afterload=[];this.initobj=a;this.outerdiv=document.getElementById(a.id);this.editordiv=undefined;this.toolbardiv=undefined;this.toolbarobject=undefined;this.popupid="ze_popups";this.popupdiv=undefined;this.createToolbar();this.createEditor();if(ZE_Init.needEditorStats){this.clickCount={}}if(ZE_Init.needplaintext){this.createPlainText();if(a.mode==="plaintext"){this.plainText(a.content)}}}ZE.create=function(a){if(ZE_Init.loading){var b=function(){ZE_Init.loadURL(ZE_Init.cssPath+"/css/"+ZE_Init.theme+"/ze1.min.css","css");if(ZE_Init.is_ie){ZE_Init.loadURL(ZE_Init.jsPath+"/js/ze_ie1.min.js","js")}else{ZE_Init.loadURL(ZE_Init.jsPath+"/js/ze1.min.js","js")}};setTimeout(b,0);delete ZE_Init.loading}return new ZE(a)};ZE.prototype.afterEditorLoad=function(a){var b=this;if(b.state){b.afterload.push(a)}else{a()}};ZE.prototype.setContent=function(b){var c=this,a,d=c.mode;if(!b){return}if(c.state){a=(function(e){return function(){c.setContent(e)}})(b);c.afterload.push(a)}else{if(d&&d==="plaintext"){c._textarea.value=b}else{c.doc.body.innerHTML=b;c.win.focus();try{c.updateToolbar()}catch(f){}}}};ZE.setProcessedContent=function(a){var b=this,c=b.mode;if(c&&c==="plaintext"){a=a.replace(/\n/gi,"<br />")}else{a=a.replace(/<br.*?>/gi,"\n")}};ZE.i18n=function(a){var b=ZE_Init.language;if(!b||b=="en"){return a}else{return(ZE.i18nObj[a]||a)}};ZE.prototype.getContent=function(){var c=this,e=c.mode,a=c.toolbarobject.spellcheck,b,d,f;if(a&&a.className==="ze_selected"){c.removeSpellcheckspans()}if(e&&e==="plaintext"){b=c._textarea;if(b){d=b.value;if(d){if(ZE_Init.setContentProcessed){d=d.replace(/\r+/gi,"");d=d.replace(/\n/gi,"<br />")}return d}}}else{f=c.doc;if(f){return f.body.innerHTML}}return""};ZE.prototype.createPlainText=function(){var c=this,b=document.createElement("span"),a=ZE.i18n;c.mode="richtext";c.span=b;b.innerHTML="&laquo; "+a("Plain Text");b.className="ze_plain";b.onclick=function(e){e=e||window.event;c._stopEvent(e);if(confirm(a("Converting this to plain text will lose some formatting")+".\n\n"+a("Are you sure you want to continue")+"?")){var d=c.toolbarobject.spellcheck;if(d&&d.className==="ze_selected"){c.removeSpellcheckEvent()}c.plainText(c.getContent());if(ZE_Init.modeChange){ZE_Init.modeChange(c.mode)}}};c.toolbardiv.appendChild(b)};ZE.prototype.plainText=function(g){var c=this,j=c.toolbardiv.getElementsByTagName("ul"),d=c.span,h=ZE.i18n,k=c._textarea;for(var a=j.length-1;a>=0;a--){j[a].style.display="none"}var b=c.toolbarobject.spellcheck;if(b){b.parentNode.parentNode.parentNode.style.display=""}d.innerHTML="&raquo; "+h("Rich Text");d.style.display="";d.onclick=function(e){e=e||window.event;c._stopEvent(e);c.richText(c._textarea.value);if(ZE_Init.modeChange){ZE_Init.modeChange(c.mode)}};c.mode="plaintext";if(!k){k=document.createElement("textarea");k.className="ze_area";c._textarea=k;c.editordiv.appendChild(k);k.onbeforedeactivate=function(){var e=document.selection;if(e){c.textrange=e.createRange()}}}if(g){k.value=ZE.getText(g)}c.iframe.style.display="none";k.style.height=c.iframe.style.height;k.style.display="";try{k.focus();if(k.setSelectionRange){k.setSelectionRange(0,0)}}catch(f){}};ZE.prototype.richText=function(g){var e=this,f=e.toolbardiv.getElementsByTagName("ul"),c=e.span,b=ZE.i18n,a=e._textarea;for(var d=f.length-1;d>=0;d--){f[d].style.display=""}c.innerHTML="&laquo; "+b("Plain Text");c.onclick=function(i){i=i||window.event;e._stopEvent(i);if(confirm(b("Converting this to plain text will lose some formatting")+".\n\n"+b("Are you sure you want to continue")+"?")){i=i||window.event;e._stopEvent(i);var h=e.toolbarobject.spellcheck;if(h&&h.className==="ze_selected"){e.removeSpellcheckEvent()}e.plainText(e.getContent());if(ZE_Init.modeChange){ZE_Init.modeChange(e.mode)}}};e.mode="richtext";a.style.display="none";if(g){e.doc.body.innerHTML=g.replace(/\ /gi," ").replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\n/gi,"<br>")}e.iframe.style.height=a.style.height;e.iframe.style.display="";setTimeout(function(){e.win.focus();e.updateToolbar()},0)};ZE.getText=function(d){if(d){var c=function(g){g=g.replace(/\n+/gi,"");g=g.replace(/\r+/gi,"");g=g.replace(/<!--.*?-->/gi,"");g=g.replace(/<head>.*?<\/head>/gi,"");g=g.replace(/<br.*?>/gi,"\n");g=g.replace(/<hr.*?>/gi,"\n");g=g.replace(/<\/p>/gi,"\n");g=g.replace(/<\/div>/gi,"\n");g=g.replace(/<\/h[1-6]>/gi,"\n");g=g.replace(/<\/tr>/gi,"\n");g=g.replace(/<\/li>/gi,"\n");g=g.replace(/<\/td>/gi," ");g=g.replace(/<\/th>/gi," ");g=g.replace(/<.*?>/gi,"");g=g.replace(/&nbsp;/gi," ");g=g.replace(/&lt;/gi,"<");g=g.replace(/&gt;/gi,">");g=g.replace(/&amp;/gi,"&");return g};var b=d.search(/<blockquote/gi);if(b!=-1){var a=d.search(/<blockquote/gi);var f=(d.toLowerCase()).lastIndexOf("</blockquote>");var e=d.substring(a,f+13);d=d.replace(e,"##===###===##");e=c(e);e=e.replace(/\n/gi,"\n > ");e=" > "+e;d=c(d);if(d.search(/##===###===##/gi)!=-1){d=d.replace("##===###===##",e)}return d}else{return c(d)}}else{return""}};ZE.prototype.setMode=function(c){var a=this,b=a.mode;if(c==="plaintext"){if(b!==c){a.plainText("")}}else{if(b!=="richtext"){a.richText("")}}};ZE.prototype.updateToolbar=function(){var d=this,b=d.toolbarobject,e=d.doc,c,a;for(c in b){switch(c){case"bold":case"italic":case"underline":case"strikethrough":case"superscript":case"subscript":case"justifyleft":case"justifyright":case"justifycenter":case"justifyfull":case"insertorderedlist":case"insertunorderedlist":if(e.queryCommandState(c)){b[c].setAttribute("class","ze_selected")}else{b[c].removeAttribute("class")}break;case"fontcolor":b[c].getElementsByTagName("img")[0].style.borderBottomColor=e.queryCommandValue("forecolor");break;case"bgcolor":a=e.queryCommandValue("hilitecolor");if(/transparent/i.test(a)){a=e.queryCommandValue("backcolor")}b[c].getElementsByTagName("img")[0].style.borderBottomColor=a;break}}};ZE.prototype.createEditor=function(){var e=this,b=document,f,a,d=e.initobj,c=d.editorheight;f=b.createElement("iframe");e.iframe=f;f.className="ze_area";if(c){f.style.height=c+"px"}e.editordiv.appendChild(f);if(!b.getElementById(e.popupid)){a=b.createElement("div");a.id=e.popupid;b.body.appendChild(a)}e.popupdiv=b.getElementById(e.popupid);f.onload=function(){f.onload=null;var k=f.contentWindow,o=k.document,g=d.content,j,q,n,h,m,r,p=ZE_Init.outGoingFontFamily,i=ZE_Init.outGoingFontSize;e.win=k;e.doc=o;if(d.mode!=="plaintext"){o.open();o.write(g||"<br>");o.close()}if(ZE_Init.editorCSS){j=o.createElement("link");j.type="text/css";j.rel="stylesheet";j.href=ZE_Init.cssPath+"/css/zeditor.min.css";o.getElementsByTagName("head")[0].appendChild(j)}f.contentDocument.designMode="on";if(ZE_Init.needEditorFocus){k.focus();try{e.updateToolbar()}catch(l){}}o.addEventListener("mouseup",function(s){e.updateToolbar()},true);o.addEventListener("keypress",function(u){var z=u.keyCode,s=u.shiftKey,x=u.metaKey,w=u.altKey,v=u.ctrlKey,y=e.doc,t;if(z===9){if(ZE_Init.tabKeyHandling){if(!s&&!v){k.getSelection().collapseToStart();o.execCommand("insertHTML",false,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");e._stopEvent(u)}}}else{if((v||x)&&!w&&!s){t=String.fromCharCode(u.charCode).toLowerCase();switch(t){case"b":e.execCommand(u,"bold");break;case"i":e.execCommand(u,"italic");break;case"u":e.execCommand(u,"underline");break;case"l":e.execCommand(u,"justifyleft");break;case"e":e.execCommand(u,"justifycenter");break;case"r":e.execCommand(u,"justifyright");break;case"j":e.execCommand(u,"justifyfull");break;case"k":e.execCommand(u,"link");break}}}e.updateToolbar()},true);h=function(t,u){var s;s=o.createElement("style");s.type="text/css";s.innerHTML=".ze_body{font-family:"+t+";font-size:"+u+";}";o.getElementsByTagName("head")[0].appendChild(s);o.body.className="ze_body"};if(p||i){if(!i){h(p,ZE_Init.defaultFontSize)}else{h(p,i)}}else{m=d.defaultfontfamily||ZE_Init.defaultFontFamily||"";r=d.defaultfontsize||ZE_Init.defaultFontSize||"";h(m,r)}delete e.state;if(e.afterload){q=e.afterload;n=q.length;while(n--){(q.shift())()}}delete e.afterload}};ZE.prototype._stopEvent=function(a){a.preventDefault();a.stopPropagation()};ZE.prototype.createToolbar=function(){var n=this,r={},b,l=n.initobj.toolbar,A=document,c=A.createDocumentFragment(),s=ZE.i18n,u=ZE_Init.imgPath,w,h,q,y=0,o,f,e,v,z,x,d,a,t,g,p,k,C,m,B;if(l){b=ZE_Init.toolbarOrderGenerate(l)}else{b=ZE_Init.toolbarOrder}w=A.createElement("div");w.className="ze";if(!ZE_Init.needEditorBorder){w.style.borderWidth="0px"}n.editordiv=w;c.appendChild(w);n.toolbarobject=r;h=A.createElement("div");h.className="ze_toolbarbg";w.appendChild(h);n.toolbardiv=h;q=function(i){return function(j){n._stopEvent(j);n.execCommand(j,i);return false}};for(o=b.length;y<o;y++){f=A.createElement("ul");f.className="ze_multitoolbar";e=A.createElement("li");f.appendChild(e);v=A.createElement("div");e.appendChild(v);z=b[y];for(x=0,d=z.length;x<d;x++){a=z[x];t=a[0];g=a[2];p=A.createElement("a");p.title=p.href=s(a[1]);p.tabIndex="-1";p.addEventListener("click",q(t),true);p.addEventListener("mousedown",function(i){n._stopEvent(i);return false},true);r[t]=p;v.appendChild(p);if(x===0){p.appendChild(A.createElement("b"))}k=A.createElement("img");k.align="absmiddle";if(d===1){k.className="ze_tabmenuicon "+g+"si"}else{k.className="ze_tabmenuicon "+g}k.src=u+"/images/spacer.gif";p.appendChild(k);if(x===d-1){p.insertBefore(A.createElement("em"),k);if(t==="insertoptions"||t==="spellcheckoptions"){p.style.width="12px";m=p.previousSibling;if(m){B=m.previousSibling;if(B&&B.nodeName==="A"){B.style.width="25px"}}}}else{C=A.createElement("img");C.className="ze_sep_img";C.src=u+"/images/spacer.gif";v.appendChild(C)}}h.appendChild(f)}if(r.heading){(function(){var i=r.heading.appendChild(A.createElement("span"));i.className="ze_heading_menu";i.appendChild(A.createTextNode("Nr"))}())}if(typeof ZE_Init.afterToolbarGenerate==="function"){ZE_Init.afterToolbarGenerate(r)}n.outerdiv.appendChild(c)};